---
title: "Technical Appendix"
author: "Ilayda Dinc & Sara Orofino"
date: "5/28/2019"
output: pdf_document
---

```{r setup, include=FALSE, message=FALSE}
# Packages and data

library(tidyverse)
library(janitor)

carbon <- read_csv("HW4Data.csv") %>% 
  clean_names()

```

###1. Marginal Cost of Abatement by Sector 

####Sector A

```{r, include=FALSE, message=FALSE}
# First make trial graph to see what function it might be 
trial_a <- ggplot(carbon, aes(x=abatement, y=mc_a)) +
  geom_point() +
  geom_smooth()

trial_a 

# Looks linear

# Use linear regression to find the equation of the line

a_lm <- lm(mc_a ~ abatement, data=carbon)

# Store coefficients of regression
int_a <- a_lm$coefficients[1]
slope_a <- a_lm$coefficients[2]

 
```

$Marginal~Cost~Abatement~Sector~A = `r slope_a`*q + `r int_a`$  

####Sector B

```{r, include=FALSE, message=FALSE}

# First make trial graph to see what function it might be

# sam is gonna use linear
trial_b <- ggplot(carbon, aes(x=abatement, y=mc_b)) +
  geom_point() +
  geom_smooth()

trial_b

# Try fitting linear regression

b_lm <- lm(mc_b ~ abatement, data = carbon)

# Graph it to check the fit 
b_lm_graph <- ggplot(carbon, aes(x=abatement, y=mc_b)) +
  geom_point() + 
  geom_smooth(method = "lm", formula = y~x)

b_lm_graph


# Fit looks okay - save the regression coefficients
int_b <- b_lm$coefficients[1]
slope_b <- b_lm$coefficients[2]


```

$Marginal~Cost~Abatement~Sector~B = `r slope_b`*q + `r int_b`$


####Sector C

```{r, include=FALSE, message=FALSE}
# First make trial graph to see what function it might be
trial_c <- ggplot(carbon, aes(x=abatement, y=mc_c)) +
  geom_point() +
  geom_smooth()

trial_c

c_lm <- lm(mc_c ~ abatement, data = carbon)

# save the regression coefficients
int_c <- c_lm$coefficients[1]
slope_c <- c_lm$coefficients[2]



# Looks exponential (check lab 4 from 244 if you have to use nls)

# mutate a new column of exp(Abatement) than lm(Price~exp(abatement)), you will end up y= b0+ b1*exp(x)

# sam used linear for all, he said it is gonna be easier for the later parts


```

$Marginal~Cost~Abatement~Sector~C = `r slope_c`*q + `r int_c`$

####Sector D

```{r, include=FALSE, message=FALSE}
# First make trial graph to see what function it might be
trial_d <- ggplot(carbon, aes(x=abatement, y=mc_d)) +
  geom_point() +
  geom_smooth()

trial_d

# Trying quadratic

d_lm <- lm(mc_d ~ abatement+I(abatement^2), data = carbon)

int_d <- d_lm$coefficients[1]
c1_d <- d_lm$coefficients[2]
c2_d <- d_lm$coefficients[3]


d_lm_graph <- ggplot(carbon, aes(x=abatement, y=mc_d)) +
  geom_point() + 
  geom_smooth(method = "lm", formula = y~x+I(x^2))

d_lm_graph

# quadratic looks good to me

# trying linear

linear_d <- lm(mc_d ~ abatement, data = carbon)

int_lineard <- linear_d$coefficients[1]
slope_d <- linear_d$coefficients[2]




```

$Marginal~Cost~Abatement~Sector~D = `r c1_d`*q + `r c2_d`*q^2 +`r int_d`$

###2. Demand for Carbon Emissions 

```{r, include=FALSE}

####### Sector A Demand Curve:  
# Current emissions are 180 - use quantities from 0 to 180 by 10
quantity_a <- seq(0,180,by=10)


# Write function for demand curve for Sector A

d_a <- function(q){
  (slope_a*(180-q)) + int_a
}

# Derive demand curve using the values above
demand_a <- d_a(quantity_a)

# Graph it to see if this worked....
curve(d_a, from=0, to=180, xlab = "x", ylab = "y")

# willing to pay 95.2 for the first ton of emissions 


######## Sector B Demand Curve:  

# Current emissions are 200 - use quantities from 0 to 200 by 10
quantity_b <- seq(0,200,by=10)

# Write function for demand curve for Sector B

d_b <- function(q){
  (slope_b*(200-q) + int_b)
}

# Graph it 
curve(d_b, from=0, to=200, xlab = "x", ylab = "y")

# Plug in quantities into function to check
demand_b <- d_b(quantity_b)


######## Sector C Demand Curve: 

# Current emissions are 220 - use quantities from 0 to 220 by 10
quantity_c <- seq(0,220,by=10)

# Write function for demand curve for Sector C

d_c <- function(q){
  (slope_c*(220-q) + int_c)
}

# Graph it 
curve(d_c, from=0, to=220, xlab = "x", ylab = "y")

# Plug in quantities into function to check
demand_c <- d_c(quantity_c)


######## Sector D Demand Curve:  
quantity_d <- seq(0,300, by=10)

d_d <- function(q){
  (slope_d*(300-q) + int_lineard)
}


```

*Demand Curves*  

Plugging in O for q will result in the willingness to pay for the right to pollute the first unit.

Sector A:  $Price~of~Emissions = `r slope_a`*(180-q) + `r int_a`$  
 - Willingness to Pay for First Unit = \$95.2    

Sector B:  

$Price~of~Emissions = `r slope_b`*(200-q) + `r int_b`$  

- Willingness to Pay for First Unit = \$49.12 

Sector C:

$Price~of~Emissions = `r slope_c`*(220-q) + `r int_c`$  

- Willingness to Pay for First Unit = \$160.78

Sector D:

$Price~of~Emissions = `r c1_d`*(300-q) + `r c2_d`*(300-q)^2 +`r int_d``$  

- Willingness to Pay for First Unit = \$185.46  

$Price~of~Emissions = `r slope_d`*(300-q) +`r int_lineard``$   

- Willingness to Pay with Linear Function: \$87.69    

Note: The rest of the anlaysis will use the linear demand equations for each sector.    

###3. Country X

Suppose to meet the Paris Accord commitments, Country X (which contains sectors A, B, and C) needs to cut all carbon emissions in half. For each policy option derive the following:  
1. The total cost of meeting the target in Country X  
2. The cost (or benefit) to each sector  
3. The tax revenue generated  

####a. Cap on Carbon  

```{r}

# Each sector cuts emissions by 100 - abates 100 
################# Part 1 Write abatement curve functions for each sector and plug in 100 for Q

#### Abatement function Sector A

abate_a <- function(q){
  (slope_a*q) + int_a
}

costa_100 <- abate_a(100) 

#### Abatement function Sector B

abate_b <- function(q){
  (slope_b*q) + int_b
}

costb_100 <- abate_b(100)

#### Abatement function Sector C

abate_c <- function(q){
  (slope_c*q) + int_c
}

costc_100 <- abate_c(100)

#### Abatement function Sector D - NOT used in this question

abate_d <- function(q){
  (slope_d*q) + int_lineard
}

################## Part 2 Integrate to find the area under the curve (the cost of abatement from 0-100)

areaa_100 <- integrate(abate_a, lower = 0, upper = 100)$value

areab_100 <- integrate(abate_b, lower = 0, upper = 100)$value

areac_100 <- integrate(abate_c, lower = 0, upper = 100)$value

################## Part 3 Add all areas together to find the total cost of abating 100 units from each sector

totalcost_100 <- areaa_100 + areab_100 + areac_100
```



1. Total Cost of Carbon Cap   
$Total~Cost = `r round(totalcost_100, digits=6)`$   

2. Cost/Benefits to each Sector    
$Cost~to~Sector~A = `r round(areaa_100, digits=6)`$    

$Cost~to~Sector~B = `r round(areab_100, digits=6)`$    

$Cost~to~Sector~C = `r round(areac_100, digits=6)`$    

3. Tax Revenue  
There is no tax revenue with a carbon cap  

####b. Tax on Carbon 

```{r}

```


1. Total Cost of Carbon Cap     

2. Cost/Benefits to each Sector    

3. Tax Revenue    


####c. Cap and Trade  




1. Total Cost of Carbon Cap     

2. Cost/Benefits to each Sector    

3. Tax Revenue    



###4. Country Y

Country Y contains only Sector D and is not obligated to reduce its emissions. To enter into Country X's carbon market Country Y would need to cap its emissions at its current level (300 tons) but allows them to sell credits to Sectors A, B, and C in Country X.   

Incentives for Country Y to enter the carbon market:  


Incentives for Country X to attract Country Y to the carbon market:  


###5. Local Air Pollution  

Now assume every ton of carbon emissions creates one ton of local air pollution. Local air pollution only causes economic damages in the country where it is emitted. Neither Country X nor Country Y have local air pollution regulations.  

####a. Carbon Cap and Trade Market only Covering Country X  

How much local air pollution would you expect in Country X and Country Y?  



####b. Country Y enters the Carbon Market of Country X  

How much local air pollution would you expect in Country X and Country Y?  




####c. Advice on International Trade of Carbon Emission Credits  

